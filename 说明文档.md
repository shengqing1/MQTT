# Linux环境下C语言实现MQTT协议与华为云IOT平台通信

## 项目概述

本项目旨在通过C语言在Linux环境下实现MQTT协议，以实现与华为云IOT平台的高效通信。MQTT（Message Queuing Telemetry Transport）是一种轻量级的发布/订阅消息传输协议，广泛用于物联网通信。此项目通过自定义的C语言库与应用程序，展示了如何在嵌入式设备或服务器上建立MQTT客户端，进行设备认证、消息订阅与发布等功能。

## 关键特性

1. **MQTT协议实现**：使用C语言实现MQTT的核心功能，包括连接、订阅、发布和心跳维持。
2. **华为云IOT平台集成**：项目配置了与华为云IOT平台的连接参数，如服务器地址、端口、客户端ID、用户名和密码，确保设备能够顺利接入云平台。
3. **消息处理**：实现了消息的接收与发送逻辑，支持JSON格式的消息体，便于传输结构化数据。
4. **错误处理**：包含了网络连接和MQTT通信过程中的错误处理机制，确保通信的稳定性和可靠性。
5. **跨平台兼容性**：代码基于Linux平台开发，具有较好的跨平台特性，可轻松移植到其他支持C语言的操作系统。

## 技术细节

- **编程语言**：C语言
- **主要库文件**：`mqtt.cpp`, `main.cpp`, `mqtt.h`
- **网络通信**：使用TCP/IP协议栈进行网络通信，通过套接字编程实现数据的发送与接收。
- **MQTT报文处理**：详细实现了MQTT报文的构建与解析，包括连接报文、订阅报文、发布报文等。
- **心跳机制**：通过定时发送心跳报文维持与服务器的连接。

## 使用方法

1. **环境配置**：确保Linux环境已安装GCC编译器和必要的网络开发库。
2. **代码编译**：使用GCC编译器编译源代码，生成可执行文件。
3. **运行程序**：执行编译后的程序，开始与华为云IOT平台进行通信。
4. **参数配置**：根据实际需求调整服务器地址、端口和认证信息。

## 部署华为云物联网平台

1. **打开官网**：

   华为云官网: https://www.huaweicloud.com/

   打开官网，搜索物联网，就能快速找到设备接入IOT

   ![image-20240918182117871](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918182117871.png)

   ![image-20240918182211371](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918182211371.png)

   点击控制台进入

   ![image-20240918182416956](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918182416956.png)

   进入后提示

   ![image-20240918182915973](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918182915973.png)

   点击总览，可以看到接入信息。

   ![image-20240918183101214](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183101214.png)

   ![image-20240918183139040](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183139040.png)

   

2. **创建产品**：

   点击产品，创建产品

   ![image-20240918183318617](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183318617.png)

   填写信息

   ![image-20240918183434268](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183434268.png)

   产品创建成功后，点击进入产品详情页面，如图应该点击“智能家居系统”

   ![image-20240918183518022](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183518022.png)

   点击自定义模型，根据个人需求修改，图中演示项目使用的配置，创建一个服务ID为stm32

   ![image-20240918184024017](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918184024017.png)

   点击新增属性

   ![image-20240918183701685](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183701685.png)

   如图设置属性，可根据个人需求修改，图中是示例程序中用到的属性

   ![image-20240918183812518](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918183812518.png)

   3.**添加设备**：

   回到详情页，点击注册设备

   ![image-20240918184223245](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918184223245.png)

   根据个人需求填写，如图示例

   ![image-20240918184449635](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918184449635.png)

   ![image-20240918184539053](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918184539053.png)

   点击确定即可创建完毕

   3.**获取MQTT三元组**：

   MQTT鉴权三元组生成工具： https://iot-tool.obs-website.cn-north-4.myhuaweicloud.com/

   ![image-20240918184835860](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918184835860.png)

   填入设备ID和密码点击生成即可获得三元组

   ![image-20240918185122806](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918185122806.png)

   ID和密码刚才注册时已经获得，如果你忘了，进入设备详情页即可复制设备ID

   ![image-20240918185308550](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918185308550.png)

   三元组的信息就是代码中需要你自己修改的部分，在代码main.cpp这里（9-14行）

![image-20240918185451365](C:\Users\PIKABU\AppData\Roaming\Typora\typora-user-images\image-20240918185451365.png)

我的测试环境实在linux下使用clion跑的代码，结果如图所示
![img](file:///C:/Users/PIKABU/Desktop/MQTT/屏幕截图%202024-09-18%20172612.png)

可以看到华为云平台信息更新成功

![img](file:///C:/Users/PIKABU/Desktop/MQTT/屏幕截图%202024-09-18%20172942.png)

